<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="style/base.css" type="text/css" />
		<link rel="stylesheet" href="style/base.css" type="text/css" />
    </head>

    <body class="m-0">
        <div class="py-4">
            <div class="container">
                <h2>Welcome to the <strong>Specimen Data Refinery</strong>, part of SYNTHESIS+</h2>
				<p>Insert some text about the project here</p>
				<h3>Bulk upload</h3>
				<p>This form can be used to schedule multiple digitisations at once</p>
				<p>Currently this bulk upload feature only supports up to 10 imageses at once</p>
				<p>Uploads must be in the following format
					<ul>
						<li>Comma separated value file, containing the following columns</li>
						<li>
							<ul>
								<li>Catalog number</li>
								<li>Image license	</li>
								<li>Image URI</li>
								<li>Object type</li>
								<li>Rights holder</li>
								<li>Institution URL</li>
								<li>Higher classification</li>
								<li>Person name</li>
								<li>Person identifier</li>
							</ul>
						</li>
						<li>CSV may contain headers</li>
					</ul>
				
				</p>
                <form>
			        Upload 
			        <br/>
			        <input type="file" id="fileinput"/>
				</form>
				<div id="upload_results1"></div>
				<div id="upload_results2"></div>
				<script>
				    function readSingleFile(evt) {
						var f = evt.target.files[0]; 
						if (f) {
							var success_text = "";
							var r = new FileReader();
                            r.onload = function(e) { 
								var contents = e.target.result;
								success_text = "File Uploaded! <br />" + "name: " + f.name + "<br />" + "type: " + f.type + "<br />" + "size: " + f.size + " bytes <br />";
								var lines = contents.split("\n"), output = [];
								for (var i=0; i<lines.length; i++) {
								    output.push("<tr><td>" + lines[i].split(",").join("</td><td>") + "</td></tr>");
								}
								output = "<table>" + output.join("") + "</table>";
								document.getElementById('upload_results1').innerHTML = success_text;
								document.getElementById('upload_results2').innerHTML = output;
						    }
							r.readAsText(f);
							
							//create dropdown to choose workflow
							
							    var xmlHttp = new XMLHttpRequest();
								xmlHttp.open( "GET", "https://sdr.nhm.ac.uk/api/workflows", false ); // false for synchronous request
								xmlHttp.send( null );
								alert( xmlHttp.responseText );
							
							
							
							//var xhr = new XMLHttpRequest();
							//xhr.open("POST", "https://sdr.nhm.ac.uk/api", true);
							//xhr.setRequestHeader('Content-Type', 'application/json');
							//xhr.send(JSON.stringify({
							//	value: value
							//}));
						} 
						else { 
						    alert("Failed to load file");
					    }
				    }
			 	    document.getElementById('fileinput').addEventListener('change', readSingleFile);
					
				</script>			
            </div>
        </div>
    </body>
</html>